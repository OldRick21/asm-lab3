# Документация к ассемблерной программе шифрования Цезаря

## Секция `.data`

### Выделение буфера

buffer times 255 db 0

    Назначение: Буфер для хранения вводимых данных.

    Детали:

        times 255 - повторяет инструкцию 255 раз.

        db 0 - инициализирует каждый байт нулём.

        Общий размер: 255 байт.

Константа размера буфера

b_size equ $ - buffer

    Назначение: Вычисление размера буфера во время компиляции.

    Детали:

        $ - текущий адрес.

        $ - buffer - разница между текущим адресом и началом буфера.

Имя файла для записи

filename db "output.txt", 0

    Назначение: Имя выходного файла с нуль-терминатором.

    Детали:

        db - объявление байтовой строки.

        0 - нуль-терминатор для совместимости с системными вызовами.

Смещение для шифра


offset db 33 ;7

    Назначение: Значение смещения для шифра Цезаря.

    Примечание: В комментарии указано альтернативное значение (7).

Секция .text
Точка входа


global _start
_start:
    jmp sys_read

    Назначение: Стандартная точка входа для программ на Linux.

    Детали:

        global _start - делает метку доступной линкеру.

        jmp sys_read - немедленный переход к логике чтения.

Логика чтения (sys_read)
Системный вызов чтения

    mov rax, 0  
    mov rdi, 0 
    mov rsi, buffer
    mov rdx, b_size
    syscall 

    Параметры:

        rax=0 - номер системного вызова sys_read.

        rdi=0 - файловый дескриптор stdin.

        rsi=buffer - указатель на буфер.

        rdx=b_size - максимальное количество байт.

Обработка результата



mov r9, rax
cmp rax, b_size
jge err
cmp rax, 0
je _end

    Детали:

        r9 сохраняет количество прочитанных байт.

        Проверка на переполнение буфера.

        Проверка на EOF (0 байт прочитано).

Подготовка к шифрованию
Инициализация счетчиков



mov r10, 0
mov r11, r9
sub r11, 1

    Назначение:

        r10 - индекс текущего символа (начинается с 0).

        r11 - индекс последнего символа (длина - 1).

Нормализация смещения



movzx rax, byte [offset]
xor rdx, rdx
mov rbx, 26
div rbx
mov rax, rdx

    Детали:

        Преобразует смещение в диапазон 0-25.

        div rbx - делит на 26, остаток в rdx.

Логика шифрования (caesar_cipher_start)
Определение регистра символа



cmp byte [buffer + r10], 0x5A
jle upper
jmp lower

    Логика:

        Символы ≤ 0x5A ('Z') обрабатываются как верхний регистр.

        Остальные - как нижний.

Обработка верхнего регистра



upper:
mov r12b, byte [buffer + r10]
add r12b, al
cmp r12b, 0x5A
jg upper_overflow

    Переполнение:

        Если результат > 'Z', корректировка:
        asm
        Copy

        sub r12b, 0x5A
        mov byte [buffer + r10], 0x40
        add byte [buffer + r10], r12b

Обработка нижнего регистра


lower:
movzx r12, byte [buffer + r10]
add r12, rax
cmp r12, 0x7A
jg lower_overflow

    Переполнение:

        Если результат > 'z', корректировка:
        asm
        Copy

        sub r12b, 0x7A
        mov byte [buffer + r10], 0x60
        add byte [buffer + r10], r12b

Запись в файл (sys_file_write)
Открытие файла


mov rax, 2
mov rdi, filename
mov rsi, 0x441
mov rdx, 0755o
syscall

    Параметры:

        rax=2 - системный вызов open.

        rsi=0x441 - флаги: O_WRONLY|O_CREAT|O_APPEND.

        rdx=0755o - права доступа (rwxr-xr-x).

Запись данных


mov r8, rax
mov rax, 1
mov rdi, r8
mov rsi, buffer
mov rdx, r9
syscall

    Параметры:

        rax=1 - системный вызов write.

        rdi - файловый дескриптор.

        rdx=r9 - количество байт для записи.

Завершение программы
Обработка ошибки


err:
mov eax, 60
mov edi, 1
syscall

    Детали:

        exit(1) при переполнении буфера.

Нормальное завершение


_end:
mov eax, 60
mov edi, 0
syscall

    Детали:

        exit(0) при обнаружении EOF.